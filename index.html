<!DOCTYPE html>

<html>
	<head>
		<title>24h v√©lo LLN (2023)</title>
		<meta charset="utf-8">

		<script src="index.js"></script>

		<!-- models -->

		<script src="models/kap.js"></script>
		<script src="models/radio.js"></script>
		<script src="models/guitar.js"></script>

		<style>
			body {
				margin: 0;
				padding: 0;
				overflow: hidden;
			}

			.overlay {
				width: 100vw;
				height: 100vh;
				position: absolute;
			}

			.cse-warning {
				display: flex;
				align-items: center;
				justify-content: space-around;
				flex-direction: column;
				color: red;
			}

			.bsod {
				background: url("res/bsod.png");
				background-size: cover;
			}

			video {
				width: 100%;
				height: 100%;
			}

			/* XXX yeah a little hacky ig */

			div[hidden] {
				display: none;
			}
		</style>

		<!-- KAP shader -->

		<script id="kap-vert" type="x-shader/x-vertex">#version 300 es
			precision mediump float;

			layout(location = 0) in vec3 a_pos;
			layout(location = 1) in vec2 a_tex_coord;
			layout(location = 2) in vec3 a_normal;

			uniform mat4 u_model;
			uniform mat4 u_vp;

			out vec3 pos;
			out vec4 world_pos;
			out vec2 tex_coord;
			out vec3 normal;

			void main(void) {
				pos = a_pos;
				world_pos = u_model * vec4(pos, 1.0);
				gl_Position = u_vp * world_pos;
				tex_coord = a_tex_coord;
				normal = a_normal/ 2.0 + 0.5;
			}
		</script>

		<script id="kap-frag" type="x-shader/x-fragment">#version 300 es
			precision mediump float;
			precision lowp int;

			in vec3 pos;
			in vec4 world_pos;
			in vec2 tex_coord;
			in vec3 normal;

			uniform vec3 u_pl_pos;
			uniform vec3 u_pl_color;
			uniform float u_pl_intensity;

			uniform float u_time;
			uniform bool u_rainbow;

			out vec4 frag_colour;

			void main(void) {
				vec3 light_dir = normalize(u_pl_pos - world_pos.xyz);

				float attenuation = max(dot(normalize(normal), light_dir), 0.0);
				vec3 diffuse = attenuation * u_pl_color;

				vec3 ambient = vec3(1.0, 0.0, 0.1);
				if (u_rainbow) {
					ambient = vec3(abs(sin(u_time)), abs(cos(u_time)), abs(tan(u_time)));
				}

				ambient *= 0.5;

				frag_colour = vec4(ambient + diffuse, 1.0);
			}
		</script>

		<!-- fullbright shader -->

		<script id="fullbright-vert" type="x-shader/x-vertex">#version 300 es
			precision mediump float;

			layout(location = 0) in vec3 a_pos;
			layout(location = 1) in vec2 a_tex_coord;

			uniform mat4 u_model;
			uniform mat4 u_vp;

			out vec2 tex_coord;

			void main(void) {
				gl_Position = u_vp * u_model * vec4(a_pos, 1.0);
				tex_coord = a_tex_coord;
			}
		</script>

		<script id="fullbright-frag" type="x-shader/x-fragment">#version 300 es
			precision mediump float;
			precision lowp int;

			uniform sampler2D u_tex;

			in vec2 tex_coord;

			out vec4 frag_colour;

			void main(void) {
				vec4 colour = texture(u_tex, tex_coord.yx);
				frag_colour = colour;
			}
		</script>

	</head>
	<body>
		<canvas id="canvas" class="overlay" width="480" height="288"></canvas>

		<div class="overlay" id="guindaille" hidden>
			<video id="guindaille-video">
				<source src="res/guindaille.mp4" type="video/mp4">
			</video>
		</div>

		<div class="overlay" id="sacha" hidden>
			<video id="sacha-video">
				<source src="res/sacha.mp4" type="video/mp4">
			</video>
		</div>

		<div class="overlay" id="infeau" hidden>
			<video id="infeau-video">
				<source src="res/infeau.mp4" type="video/mp4">
			</video>
		</div>

		<div class="overlay" id="decompte" hidden>
			<video id="decompte-video">
				<source src="res/decompte.mp4" type="video/mp4">
			</video>
		</div>

		<div class="overlay" id="koty" hidden>
			<video id="koty-video">
				<source src="res/kotyledon.mp4" type="video/mp4">
			</video>
		</div>

		<div class="overlay" id="112" hidden>
			<img id="112-image">
				<source src="res/kot-112.jpg">
			</img>
		</div>

		<div class="overlay cse-warning" id="cse-warning" hidden>
			<h3>Avertissement du CSE</h3>
			<h1 id="cse-warning-text"></h1>
		</div>

		<div class="overlay cse-warning" id="cse-edit-warning" hidden>
			<h3>Modifier l'avertissement du CSE</h3>
			<input type="text" id="cse-warning-input" value="Ceci est un message de test"></input>
			<button onclick="big_screen.change_state('c')">Afficher le message</button>
		</div>

		<div class="overlay bsod" id="bsod" hidden>
		</div>
	</body>
</html>
